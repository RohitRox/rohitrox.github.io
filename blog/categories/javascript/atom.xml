<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Javascript | Blog @ RohitRox]]></title>
  <link href="http://rohitrox.github.io/blog/categories/javascript/atom.xml" rel="self"/>
  <link href="http://rohitrox.github.io/"/>
  <updated>2015-06-24T02:14:43-04:00</updated>
  <id>http://rohitrox.github.io/</id>
  <author>
    <name><![CDATA[Rohit Rox]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[hangman game with emberjs]]></title>
    <link href="http://rohitrox.github.io/2014/02/20/hangman-game-with-emberjs/"/>
    <updated>2014-02-20T18:00:00-05:00</updated>
    <id>http://rohitrox.github.io/2014/02/20/hangman-game-with-emberjs</id>
    <content type="html"><![CDATA[<p>I built hangman game with emberjs, <a href="http://rohitrox.github.io/hangman-with-ember">quick prevew</a>. The game deals with more of view stuffs than other parts, I would like to share some thoughts and tricks I learned during the process.</p>

<p><img src="/images/blog_post_images/hangman-ember.png" alt="hangman game with emberjs" /></p>

<p>I am not an ember expert so the way I have done may not be the optimal way of doing things in ember. Instead of walking through each steps, the code is well commented you can easily walk through, here I will describe striking stuffs.</p>

<!-- more -->


<h3>View and Controller back-and-forth</h3>

<p>As you can see in the UI we have buttons with alphabets through which we capture user input. For this, I created my own input view that extended from Ember.TextField.</p>

<p>``` coffeescript</p>

<pre><code># app/views/hangman_input.coffee
App.HangmanInputView = Ember.TextField.extend
  type: "button"
  resetted: false
  didInsertElement: -&gt;
    @get('targetObject').on('reset', $.proxy(@reset, @));
  click: -&gt;
    value = @get('value')
    controller = @get('targetObject')
    controller.send('submit', value)
    if @resetted
      @set('resetted', false)
    else
      @toggleProperty('disabled')
  reset: -&gt;
    @set('disabled', false)
    @set('resetted', true)
</code></pre>

<p>```</p>

<p>We get the current controller via <code>@get('targetObject')</code> then we can call action of controller with send.</p>

<p>We also need to be able to trigger view action &lsquo;reset&rsquo; from the controller. The reset action resets the the input panel.</p>

<p>The trick is well described <a href="http://stackoverflow.com/questions/15991871/ember-js-how-to-trigger-view-method-from-controller">here</a> using Ember.Evented mixin.</p>

<h2>Controller properties sortable</h2>

<p>I have set scores in the setupConctroller of IndexRoute. What I want to do it, for each game session I create a Score model and push it to scores but I want to be auto sorted by latest &lsquo;id&rsquo;. For this we can do something like this</p>

<p>``` coffeescript</p>

<pre><code># app/routes/index.coffee
App.IndexRoute = Ember.Route.extend
  model: -&gt;
    # ...
    score = @store.createRecord('score',{value: 0})
    # sort scores by id desc so that latest score comes on top in UI
    scores = Ember.ArrayProxy.createWithMixins Ember.SortableMixin,
      content: [controller.current_score]
      sortProperties: ['id']
      sortAscending: false
    controller.set('scores', scores)
</code></pre>

<p>```</p>

<h2>Helpers Gotchas</h2>

<p>I wrote a helper to display the green bars that represents the life.</p>

<p>``` coffeescript
  # app/helpers/life_blocks.coffee
  Ember.Handlebars.registerHelper &ldquo;life_blocks&rdquo;, (n) &ndash;></p>

<pre><code>accum = ""
i = 0
n = @get(n)
while i &lt; n
  accum += '&lt;div&gt;&lt;/div&gt;'
  ++i
accum
new Handlebars.SafeString(accum)
</code></pre>

<p>```</p>

<p>And from template we could do something like</p>

<p>
``` html
  <div class="life"></p>

<pre><code>{{ life_blocks life }}
</code></pre>

<p>  </div></p>

<p>```

life is a property in the controller.</p>

<p>Now what happens is by default life here is not bound to the life property in controller. So the trick is register helper with  &lsquo;Ember.Handlebars.registerBoundHelper&rsquo;</p>

<p>Rest others are pretty straight forward.</p>

<p>I have used brunch with tapas-with-ember. I found brunch better than grunt.</p>

<p>I would love to hear feedback and corrections where necessary.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript Array Tricks]]></title>
    <link href="http://rohitrox.github.io/2013/09/05/javascript-array-tricks/"/>
    <updated>2013-09-05T12:07:00-04:00</updated>
    <id>http://rohitrox.github.io/2013/09/05/javascript-array-tricks</id>
    <content type="html"><![CDATA[<p>JavaScript, at its base, is a very simple language. Due to burst of Js framework usage, in which many new developers jumps right into, there are very useful basic JavaScript techniques and tricks which many people are unaware of.</p>

<p>Today I want share some tricks with Javascript Arrays, which many developers are not using.</p>

<h3>Cloning Array</h3>

<p>``` javascript</p>

<pre><code>var a = [1,2,3];
var b = a;
// bad
// why

a.pop();
console.log(b);
//=&gt; [1,2]

var b = a.slice(0);
a.pop();
console.log(b);
//=&gt; [1,2,4]
// Good :-)
</code></pre>

<p>```</p>

<!-- more -->


<h3>Sorting</h3>

<p>``` javascript</p>

<pre><code>var a = [1,4,2,3];
console.log(a.reverse());
//=&gt; [3,2,4,1]
console.log(a.sort());
//=&gt; [1,2,3,4]

// Sort is more powerful than we think
// sort descending
console.log(a.sort(function(a,b){  return (b-a); }));
//=&gt; [4,3,2,1]
</code></pre>

<p>```</p>

<p> Array.sort() accepts an optional parameter in the form of a function, which accepts two paramameters. The array elements can sorted based on the relationship between each pair of elements &ldquo;a&rdquo; and &ldquo;b&rdquo; and the function&rsquo;s return value.</p>

<p> The three possible return numbers are:</p>

<ul>
<li>Less than 0: Sort &ldquo;a&rdquo; to be a lower index than &ldquo;b&rdquo;</li>
<li>Zero: &ldquo;a&rdquo; and &ldquo;b&rdquo; should be considered equal, and no sorting performed.</li>
<li>Greater than 0: Sort &ldquo;b&rdquo; to be a lower index than &ldquo;a&rdquo;.</li>
</ul>


<p>This enables us to to an array of objects also.</p>

<p>``` javascript</p>

<pre><code>var employees=[]
employees[0]={name:"George", age:32, retiredate:"March 12, 2014"}
employees[1]={name:"Edward", age:17, retiredate:"June 2, 2023"}
employees[2]={name:"Christine", age:58, retiredate:"December 20, 2036"}
employees[3]={name:"Sarah", age:62, retiredate:"April 30, 2020"}

// Sort by employee age

employees.sort(function(a, b){
 return a.age-b.age
});

// Sort by employee name

employees.sort(function(a, b){
    var nameA=a.name.toLowerCase(), nameB=b.name.toLowerCase()
    if (nameA &lt; nameB) //sort string ascending
        return -1 
    if (nameA &gt; nameB)
    return 1
    return 0 //default return value (no sorting)
 });

// Sort by date (retirement date)

employees.sort(function(a, b){
var dateA=new Date(a.retiredate), dateB=new Date(b.retiredate)
    return dateA-dateB //sort by date ascending
});
</code></pre>

<p>})</p>

<p>```</p>

<p>We can even use it to randomize an array.</p>

<p>``` javascript</p>

<pre><code>//Randomize the order of the array:
var myarray=[25, 8, "George", "John"]
myarray.sort(function() {return 0.5 - Math.random()}) //Array elements now scrambled
</code></pre>

<p>```</p>

<h3>Array Length for Truncation</h3>

<p>``` javascript</p>

<pre><code>var a = b = [1, 2, 3];

a = [];

// caught by JavaScript's pass-objects-by-reference nature
// :-(  a is still [1,2,3]

a.length = 0;
// :-) // a and b both []
</code></pre>

<p>```</p>

<h3>Array Merging</h3>

<p>We can merge arrays with the push method.</p>

<p>``` javascript</p>

<pre><code>var a = [1,2,3];
var b = [4,5];

// Array.prototype.push.apply(mergeTo, mergeFrom);

Array.prototype.push.apply(a, b);

// a is [1,2,3,4,5]
</code></pre>

<p>```</p>

<h3>Checking existence of element</h3>

<p>``` javascript</p>

<pre><code>a = [1,2,3];
// use indexOf method, returns a value greater that -1 if the element existes
if (arr.indexOf(3) &gt; -1){
    console.log('exists');
}else{
    console.log('does not exist');
}
</code></pre>

<p>```</p>

<h3>Remove Array element by Index</h3>

<p>``` javascript</p>

<pre><code>test = new Array();
test[0] = 'Apple';
test[1] = 'Ball';
test[2] = 'Cat';
test[3] = 'Dog';

// array.splice(index,1);

// lets remove index 2

popped = test.splice(2,1);
// test is ['Apple', 'Ball', 'Dog']
// popped is ['Cat']
</code></pre>

<p>```</p>

<p>More about splice <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/splice">here</a>.</p>

<h3></h3>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Get Selected text from Web Page]]></title>
    <link href="http://rohitrox.github.io/2013/08/23/get-selected-text-from-webpage/"/>
    <updated>2013-08-23T14:03:00-04:00</updated>
    <id>http://rohitrox.github.io/2013/08/23/get-selected-text-from-webpage</id>
    <content type="html"><![CDATA[<p>This is a quick tip you can use for getting the selected text from your webpage.</p>

<p>``` html</p>

<pre><code>&lt;p&gt;I am not selectable. You can test.&lt;/p&gt;
&lt;div id="here"&gt;
    How about selecting me. Try me.
&lt;/div&gt;
</code></pre>

<p>```</p>

<p>``` javascript</p>

<pre><code>$(document).ready(function() {

    function getSelectedText(){
        var text = "";
        if (window.getSelection) {
            text = window.getSelection();
        } else if (document.getSelection) {
            text = document.getSelection();
        } else if (document.selection) {
            text = document.selection.createRange().text;
        }
        return text;
    }

    $('#here').bind("mouseup", function(){
        alert(getSelectedText());
    });

});
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Canvas Images and Rails]]></title>
    <link href="http://rohitrox.github.io/2013/07/19/canvas-images-and-rails/"/>
    <updated>2013-07-19T15:15:00-04:00</updated>
    <id>http://rohitrox.github.io/2013/07/19/canvas-images-and-rails</id>
    <content type="html"><![CDATA[<p>With the introduction of Canvas, HTML5 has empower us to draw shapes, graphs, render texts, make gradients and patterns, manipulate images pixels, set an animations, even creating a stunning games!
All this stuffs occur on the client side in the browsers.
So let say you make an app that render some effects in a Canvas element and you want to allow user to take screenshot of the resut or save the result in your server for yourself.</p>

<p>Let&rsquo;s digg how can we do it and save that canvas as an image in ther server using Rails.</p>

<h3>Strategy 1 : Send canvas image as raw dataURL</h3>

<p>The data URI scheme is a URI scheme that provides a way to include data in-line in web pages as if they were external resources. The <code>canvas.toDataURL()</code> method returns the image data of the canvas as Data URI. And the Data URI has the image data Encodes with MIME base64.</p>

<p>Let&rsquo;s see how it works. Copy and run this javascript snippet in your browser console. Somewhere at the bottom of the page you&rsquo;ll see a green circle.</p>

<p>``` javascript</p>

<pre><code>var canvas = document.createElement('canvas');
var context = canvas.getContext('2d');
var centerX = canvas.width / 2;
var centerY = canvas.height / 2;
var radius = 70;

context.beginPath();
context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
context.fillStyle = 'green';
context.fill();
context.lineWidth = 5;
context.strokeStyle = '#003300';
context.stroke();

document.body.appendChild(canvas)
</code></pre>

<p>```
Now lets render that canvas as an image.</p>

<p>``` javascript</p>

<pre><code>var dataURL =  canvas.toDataURL('image/png');
window.location = dataURL;
</code></pre>

<p>```</p>

<!--more-->


<p>As you can see, with that weird long url string something like <code>data:image/png;base64,iVBORw0KGgoA...</code>, it render a png image. That long url is infact data uri which has image data encoded with MIME base64.</p>

<p>The format to be specific is <strong><em> data:[&lt;mime type&gt;][;charset=&lt;charset&gt;][;base64],&lt; encoded data &gt; </em></strong>.</p>

<p>Now, if we want to save that image in the server, we can just send that data uri as normal params and at the server, we can use ruby to decode that save that data as image file.</p>

<p>``` ruby</p>

<pre><code>require 'base64'

data = params[:data_uri]
// remove all extras except data
image_data = Base64.decode64(data['data:image/png;base64,'.length .. -1])

File.open("#{Rails.root}/public/uploads/somefilename.png", 'wb') do |f|
  f.write image_data
end
</code></pre>

<p>```</p>

<h3>Strategy 2 : Send It as a Blob object</h3>

<p>This method also use the dataURL but instead of send it as a raw text, we convert it to an image file object and send it.
For this we use the Blob object. Simply it&rsquo;s an object that represent a file-like object, so we create a blob object with the type PNG image, after we append this blob object to a FormData, and finally we send it through the jQuery Ajax Method.</p>

<p>Let&rsquo;s detail a bit what I say above, we already see how we get the dataURL from an object, the dataURL is only a raw text, so we need to decode it to a binary data, we already know that the type of the encoding in the dataURL is Base64, and for decode it using a JavaScript solution we use the predefined atob method, now after decoding it we get a binary data, and we need to convert it to an array where there element is a 8-bit unsigned integer values. Finally we have to put this array in a new Uint8Array object for pass it to our Blob object that represent our file, now let create a function that do this and convert our Canvas to a blob object:</p>

<p>``` javascript</p>

<pre><code>// Convert dataURL to Blob object
function dataURLtoBlob(dataURL) {
  // Decode the dataURL    
  var binary = atob(dataURL.split(',')[1]);
  // Create 8-bit unsigned array
  var array = [];
  for(var i = 0; i &lt; binary.length; i++) {
      array.push(binary.charCodeAt(i));
  }
  // Return our Blob object
  return new Blob([new Uint8Array(array)], {type: 'image/png'});
}
</code></pre>

<p>```</p>

<p>We can now create a new FormData object, put our file on it and send our data using Ajax.</p>

<p>``` javascript</p>

<pre><code>// Get our file
var file= dataURLtoBlob(dataURL);
// Create new form data
var fd = new FormData();
// Append our Canvas image file to the form data
fd.append("image", file);
// And send it
$.ajax({
   url: "/screenshot",
   type: "POST",
   data: fd,
   processData: false,
   contentType: false,
});
</code></pre>

<p>```</p>

<p>At controller:</p>

<p>``` ruby</p>

<pre><code>File.open("#{Rails.root}/public/uploads/somefilename.png", 'wb') do |f|
  f.write(params[:image].read)
end
</code></pre>

<p>```</p>

<p>So, that&rsquo;s it.</p>

<p>This method is more appropriate and faster than the first one.</p>

<p>Those wondering how to mix this with carrierwave and paperclip, here are the links:</p>

<p><a href="http://stackoverflow.com/questions/14900038/rails-carrierwave-iphone-base64-image-upload">Rails carrierwave base-64 encoded image upload</a></p>

<p><a href="https://gist.github.com/WizardOfOgz/1012107">Base64-encoded images with Paperclip</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OOP with Javascript]]></title>
    <link href="http://rohitrox.github.io/2012/11/01/oop-with-javascript/"/>
    <updated>2012-11-01T00:18:00-04:00</updated>
    <id>http://rohitrox.github.io/2012/11/01/oop-with-javascript</id>
    <content type="html"><![CDATA[<p>JavaScript has strong object-oriented programming capabilities, even though some debates have taken place due to the differences in object-oriented JavaScript compared to other languages.</p>

<h2>Objects and Classes</h2>

<p>JavaScript is a prototype-based language which contains no class statement, such as is found in C++ or Ruby. This is sometimes confusing for programmers accustomed to languages with a class statement. Instead, JavaScript uses functions as classes. Defining a class is as easy as defining a function. In the example below we define a new class called Person.
``` javascript</p>

<pre><code>function Person() { }
</code></pre>

<p><code>
To create a new instance of an object new operator.
</code> javascript</p>

<pre><code>my_person = new Person();
</code></pre>

<p>```</p>

<!-- more -->


<h2>Constructors</h2>

<p>Every action declared in the class gets executed at the time of instantiation which can act like the constructor, used to set the object&rsquo;s properties or to call methods to prepare the object for use.
``` javascript</p>

<pre><code>function Person(first_name, last_name) {
    this.first_name = first_name;
    this.last_name = last_name;
    this.full_name = this.first_name + this.last_name;
    console.log(this.full_name + ' is instantiated.');
}
</code></pre>

<p>```</p>

<h2>Methods</h2>

<p>``` javascript</p>

<pre><code>// adding sayHello method to Person
Person.prototype.sayHello = function()
{
  alert ('Hello '+ this.full_name);
};
</code></pre>

<p>```</p>

<h2>Private and Public</h2>

<p>Common issue in JavaScript is that there is no true sense of private variables. However, we can use closures to somewhat simulate privacy.
``` javascript</p>

<pre><code>function Person(first_name, last_name) {

    var balance = 0.0;
    // balance is private and cannot be accessed from outside

    addBalance = function () {  
        balance += 10;  
    }; 
    // addBalance is private and cannot be accessed from outside

    this.first_name = first_name;
    this.last_name = last_name;
    this.full_name = this.first_name + this.last_name;
    // first_name, last_name, full_name  are public variables

    console.log(this.full_name + ' is instantiated.');

    this.viewBalance = function(){ alert(balance); }
    // viewBalance is public
}   
</code></pre>

<p>```</p>

<h2>Literal version fo creating Objects and defining Methods and Properties</h2>

<p>``` javascript</p>

<pre><code>// Constructor version
function myObject(){  
    this.iAm = 'an object';  
    this.whatAmI = function(){  
        alert('I am ' + this.iAm);  
    };  
}; 

// Literal version
var myObject = {  
    iAm : 'an object',  
    whatAmI : function(){  
        alert('I am ' + this.iAm);  
    }  
} 
</code></pre>

<p>```
Literal is a preferred option for name spacing so that your JavaScript
code doesnâ€™t interfere (or vice versa) with other scripts running on the
page and also if you are using this object as a single object and not requiring
more than one instance of the object, whereas Constructor function type
notation is preferred if you need to do some initial work before the object
is created or require multiple instances of the object where each instance
can be changed during the lifetime of the script.</p>

<p>For a literally notated object, you simply use it by referencing its variable name,whereas with constructor functions you need to instantiate (create a new instance of) the object first.</p>
]]></content>
  </entry>
  
</feed>
