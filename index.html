<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      RohitRox @ Tech &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/styles.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Rohit Joshi's tech blog, tutorials and presentation slides</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about_me">About Me</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archives">Blog Archives</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/categories">Categories</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      This page is built using <a href="https://github.com/jekyll/jekyll" target="_blank">Jekyll</a>, <a href="https://github.com/poole/poole" target="_blank">Poole</a> and <a href="https://github.com/poole/lanyon" target="_blank">Lanyon</a>.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home" style="border: 2px solid #373737; padding: 2px 8px; color: #373737;">RohitRox @ Tech</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2021/05/08/getting-started-with-grpc">
        Getting started with gRPC
      </a>
    </h1>

    <span class="post-date">08 May 2021</span>

    <p>A very basic introduction of <a href="https://grpc.io/">gRPC</a> could be - a modern RPC framework built on HTTP/2 that uses <a href="https://developers.google.com/protocol-buffers">Protofbuf</a> serialization instead of commonly used text based formats such as Json or XML.</p>

<p>RPC stands for “Remote Procedure Call”, bascially means “invoking a function on another system”. SOAP(Simple Object Access Protocol) is one of the popular example of RPC and was very popular in the 90s. Remote Procedure Call techniques are thus not new and the concept has been around for decades.</p>

<p>There are issues with SOAP and traditional RPC frameworks like usage of heavy XML formats and payloads, tight coupling, schema maintenance issues, poort performance and steep learning curve. REST architecture style emerged as new cool framework that solved many shortcomings of SOAP. REST has become one of the default and widely used framework for designing and developing APIs.</p>

<p>The question arises why again RPC instead of REST? There are already good amount of articles on this subject of gRPC vs REST. Instead of debating on this subject, I’ll be focusing on salient features and development of gRPC services.</p>

<p>gRPC is a modern RPC framework built at Google (thus ‘g’ in gRPC) and the protocol itself is built on HTTP/2. Using HTTP 2 under the hood, gRPC is able to optimize the network layer; unlike REST, SOAP or GraphQL, which must to use text-based data formats, gRPC uses the Protocol Buffers (Protobuf) binary format. This gives us certain pros like:</p>
<ul>
  <li>Protobuf is extremely efficient on wire and gives high-performance, low-overhead messaging</li>
  <li>HTTP/2 supports any number of requests and responses over a single connection. Connections can also be bi-directional.</li>
  <li>Streaming requests and responses are first class</li>
</ul>

<p>In addition, gRPC supports and introduces modern tools and ecosystems to support code generation, load balancing, tracing, health checking, and authentication and seamless interoperability between clients and services written in different languages.</p>

<p>Full gRPC Inroduciton &amp; History: <a href="https://grpc.io/about/">https://grpc.io/about/</a></p>

<p>gRPC can be a great performant option for multi-language microservice communications.</p>

<h3 id="getting-started-with-grpc-in-go">Getting started with gRPC in Go</h3>

<p>Before we do anything, we need to get dependencies installed:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># Instructions for Mac OS</span>
  <span class="c"># You can find similar package for your OS</span>
  <span class="nv">$ </span>brew <span class="nb">install </span>protobuf <span class="c"># protocol buffer compiler; protoc</span>
  <span class="nv">$ </span>brew <span class="nb">install </span>protoc-gen-grpc-web <span class="c"># protoc plugin that generates code for gRPC-Web clients</span>
  <span class="nv">$ </span>brew <span class="nb">install </span>grpcurl <span class="c"># curl for gRPC servers</span>
</code></pre></div></div>

<p>An example definiton for sample Echo service with method called <code class="language-plaintext highlighter-rouge">Hello</code> that echoes back the text param passed to it. The code is heavily commented so the code self explains what it is doing.</p>

<div class="language-proto highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// use proto3 version of the protocol buffers language</span>
  <span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>

  <span class="c1">// go package for generated go files</span>
  <span class="k">option</span> <span class="na">go_package</span> <span class="o">=</span> <span class="s">"protos/"</span><span class="p">;</span>

  <span class="c1">// define a message type named Msg with field named Text of type string</span>
  <span class="c1">// each field/attribute should be assigned a unique number</span>
  <span class="c1">// These field numbers are used to identify fields in the message binary format, and should not be changed deployed</span>
  <span class="kd">message</span> <span class="nc">Msg</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">Text</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// define a RPC service named Echo</span>
  <span class="kd">service</span> <span class="n">Echo</span> <span class="p">{</span>
    <span class="c1">// defined a method for RPC service named Hello that takes a Msg and return a Msg</span>
    <span class="k">rpc</span> <span class="n">Hello</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span> <span class="k">returns</span><span class="p">(</span><span class="n">Msg</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Full Proto Language Guide: <a href="https://developers.google.com/protocol-buffers/docs/proto3">https://developers.google.com/protocol-buffers/docs/proto3</a></p>

<p>We can run <code class="language-plaintext highlighter-rouge">protoc -I ./ *.proto --go_out=. --go-grpc_out=.</code> to compile this proto file,
which will output two files <code class="language-plaintext highlighter-rouge">echo.pb.go</code> and <code class="language-plaintext highlighter-rouge">echo_grpc.pb.go</code> in <code class="language-plaintext highlighter-rouge">protos</code> folder. I am using Go as my primary language but single proto file works for over 12 programming languages.</p>

<p>Magically those file incorporates all the protobuf and grpc stuff into it. The files can be
intimidating to look at; but we don’t need to understand all of it at this moment.</p>

<p>According to our service definition, we can look out for 3 things that will be of our interest:
Definition of <code class="language-plaintext highlighter-rouge">Msg</code>, server defintion for <code class="language-plaintext highlighter-rouge">EchoServer</code> and client definition for <code class="language-plaintext highlighter-rouge">EchoClient</code>:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">package</span> <span class="n">protos</span>
  <span class="c">// ...</span>

  <span class="k">type</span> <span class="n">Msg</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">state</span>         <span class="n">protoimpl</span><span class="o">.</span><span class="n">MessageState</span>
    <span class="n">sizeCache</span>     <span class="n">protoimpl</span><span class="o">.</span><span class="n">SizeCache</span>
    <span class="n">unknownFields</span> <span class="n">protoimpl</span><span class="o">.</span><span class="n">UnknownFields</span>

    <span class="n">Text</span> <span class="kt">string</span> <span class="s">`protobuf:"bytes,1,opt,name=Text,proto3" json:"Text,omitempty"`</span>
  <span class="p">}</span>
</code></pre></div></div>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">package</span> <span class="n">protos</span>
  <span class="c">// ...</span>

  <span class="k">type</span> <span class="n">EchoClient</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Hello</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">in</span> <span class="o">*</span><span class="n">Msg</span><span class="p">,</span> <span class="n">opts</span> <span class="o">...</span><span class="n">grpc</span><span class="o">.</span><span class="n">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">Msg</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c">// ...</span>

  <span class="k">type</span> <span class="n">EchoServer</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Hello</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="o">*</span><span class="n">Msg</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">Msg</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>It might be unbelievable but all we need to do to create our gRPC service is to implement these interfaces. That means we can focus on only and only on our business logic.</p>



    <a href="/2021/05/08/getting-started-with-grpc">Read More...</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2021/04/19/testing-in-golang-projects">
        Testing in Golang Projects
      </a>
    </h1>

    <span class="post-date">19 Apr 2021</span>

    <p>Complete source code containting snippets in this post is available at <a href="https://github.com/RohitRox/go-test-supporting-project">https://github.com/RohitRox/go-test-supporting-project</a></p>

<h3 id="golang-testing-level-i-unit-tests">Golang Testing Level I: Unit Tests</h3>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c">// sample code for Post struct</span>
  <span class="k">package</span> <span class="n">models</span>

  <span class="k">type</span> <span class="n">Post</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Id</span>    <span class="kt">int</span>    <span class="s">`json:"id"`</span>
    <span class="n">Title</span> <span class="kt">string</span> <span class="s">`json:"title"`</span>
    <span class="n">Body</span>  <span class="kt">string</span> <span class="s">`json:"body"`</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="n">validPostTitlePatt</span> <span class="o">=</span> <span class="n">regexp</span><span class="o">.</span><span class="n">MustCompile</span><span class="p">(</span><span class="s">`^\w+[\w\s]+$`</span><span class="p">)</span>

  <span class="k">func</span> <span class="n">NewPostWithTitle</span><span class="p">(</span><span class="n">title</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">post</span> <span class="n">Post</span><span class="p">,</span> <span class="n">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">validPostTitlePatt</span><span class="o">.</span><span class="n">MatchString</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">err</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"title is required and only alpha-numeric characters and underscore are permitted in title"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">{</span><span class="n">Title</span><span class="o">:</span> <span class="n">title</span><span class="p">}</span>

    <span class="k">return</span>
  <span class="p">}</span>
</code></pre></div></div>
<p>Simple unit testing with <code class="language-plaintext highlighter-rouge">testing</code> package:</p>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c">// try to separate out test package</span>
  <span class="c">// it forces us to use packages as it will be used by its consumers</span>
  <span class="k">package</span> <span class="n">models_test</span> 

  <span class="k">import</span> <span class="p">(</span>
    <span class="s">"testing"</span>

    <span class="n">m</span> <span class="s">"go-test-supporting-project/models"</span>
  <span class="p">)</span>

  <span class="k">func</span> <span class="n">TestPost</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// tabular structure for test data, pretty common in go world</span>
    <span class="n">testData</span> <span class="o">:=</span> <span class="p">[]</span><span class="k">struct</span> <span class="p">{</span>
      <span class="n">title</span> <span class="kt">string</span>
      <span class="kt">error</span> <span class="kt">bool</span>
    <span class="p">}{</span>
      <span class="p">{</span><span class="s">"Hello World"</span><span class="p">,</span> <span class="no">false</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"Hello Testing 124"</span><span class="p">,</span> <span class="no">false</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"Hello_World"</span><span class="p">,</span> <span class="no">false</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"Hello World!"</span><span class="p">,</span> <span class="no">true</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"Hello World - 124"</span><span class="p">,</span> <span class="no">true</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"Hello@World"</span><span class="p">,</span> <span class="no">true</span><span class="p">},</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dat</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">testData</span> <span class="p">{</span>
      <span class="c">// t.Run for each test data</span>
      <span class="c">// func (t *T) Run(name string, f func(t *T)) bool</span>
      <span class="c">// t.Run runs f as a subtest of t called name.</span>
      <span class="n">t</span><span class="o">.</span><span class="n">Run</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">post</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">m</span><span class="o">.</span><span class="n">NewPostWithTitle</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dat</span><span class="o">.</span><span class="kt">error</span> <span class="p">{</span>
          <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="c">// use t.Errorf/t.Error to log and mark failed test</span>
            <span class="c">// use t.Fataf/t.Fatal to log and fast fail</span>
            <span class="c">// use t.Logf/t.Log to log only</span>
            <span class="c">// t.Skip to skip</span>
            <span class="c">// Full docs https://golang.org/pkg/testing/#pkg-index</span>
            <span class="n">t</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"Expected error Got nil for post: %s"</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">Title</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="n">t</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"Unexpected error: %s for post: %s"</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">Title</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Testable Examples:</p>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">package</span> <span class="n">models_test</span>

  <span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="n">m</span> <span class="s">"go-test-supporting-project/models"</span>
  <span class="p">)</span>

  <span class="c">// use Example to run and verify example code</span>
  <span class="c">// a concluding line comment that begins with "Output:" and is compared with the standard output of the function when the tests are run</span>
  <span class="c">// Example snippets of Go code are also displayed as package documentation</span>
  <span class="c">// More info: https://blog.golang.org/examples</span>
  <span class="k">func</span> <span class="n">ExamplePost</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">title</span> <span class="o">:=</span> <span class="s">"Hello Testing 124"</span>
    <span class="n">post</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">m</span><span class="o">.</span><span class="n">NewPostWithTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Invalid title"</span><span class="p">)</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Post initialied with title: %s"</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">Title</span><span class="p">)</span>
    <span class="c">// Output:</span>
    <span class="c">// Post initialied with title: Hello Testing 124</span>
  <span class="p">}</span>
</code></pre></div></div>

<h3 id="golang-testing-level-i-handlercontroller-tests">Golang Testing Level I: Handler/Controller Tests</h3>

<p>A Sample handler func:</p>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"net/http"</span>
  <span class="p">)</span>

  <span class="k">type</span> <span class="n">Handler</span> <span class="k">struct</span> <span class="p">{}</span>

  <span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="n">Handler</span><span class="p">)</span> <span class="n">Status</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">"Status OK"</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">httptest</code> package provides a replacement for the ResponseWriter called ResponseRecorder. We can pass it to the handler and check how it looks like after its execution:</p>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">import</span> <span class="p">(</span>
    <span class="s">"net/http"</span>
    <span class="s">"net/http/httptest"</span>
    <span class="s">"testing"</span>
  <span class="p">)</span>

  <span class="k">func</span> <span class="n">TestStatusHandler</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t</span><span class="o">.</span><span class="n">Run</span><span class="p">(</span><span class="s">"status check"</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
      <span class="c">// initialize a new request</span>
      <span class="n">req</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span> <span class="s">"/anyroute"</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">t</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
      <span class="p">}</span>

      <span class="n">h</span> <span class="o">:=</span> <span class="n">Handler</span><span class="p">{}</span>

      <span class="c">// create a ResponseRecorder (which satisfies http.ResponseWriter) to record the response</span>
      <span class="n">rec</span> <span class="o">:=</span> <span class="n">httptest</span><span class="o">.</span><span class="n">NewRecorder</span><span class="p">()</span>
      <span class="c">// call the handler</span>
      <span class="n">h</span><span class="o">.</span><span class="n">Status</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

      <span class="c">// check status code</span>
      <span class="c">// can also check rec.Body for response body</span>
      <span class="k">if</span> <span class="n">status</span> <span class="o">:=</span> <span class="n">rec</span><span class="o">.</span><span class="n">Code</span><span class="p">;</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span> <span class="p">{</span>
        <span class="n">t</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"expected sattus code: %v got: %v"</span><span class="p">,</span>
          <span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>

</code></pre></div></div>



    <a href="/2021/04/19/testing-in-golang-projects">Read More...</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2021/04/10/just-golang-things">
        Just Golang Things
      </a>
    </h1>

    <span class="post-date">10 Apr 2021</span>

    <h3 id="nil-slice-vs-empty-slice">Nil Slice Vs Empty Slice</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c">// create a nil slice of integers</span>
  <span class="k">var</span> <span class="n">arr</span> <span class="p">[]</span><span class="kt">int</span>

  <span class="c">// create an empty slice of integers</span>
  <span class="n">arr</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="unnecessary-blank-identifier">Unnecessary blank identifier</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c">// works just fine</span>
  <span class="k">for</span> <span class="k">range</span> <span class="n">something</span>
  <span class="p">{</span>
    <span class="n">run</span><span class="p">()</span>
  <span class="p">}</span>
</code></pre></div></div>

<h3 id="checking-inerfaces-and-types-in-runtime">Checking inerfaces and types in runtime</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">type</span> <span class="n">BroadcastIface</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Broadcast</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="n">temp</span> <span class="k">interface</span><span class="p">{}</span> <span class="o">=</span> <span class="n">somevar</span>
	<span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">temp</span><span class="o">.</span><span class="p">(</span><span class="n">BroadcastIface</span><span class="p">)</span>

  <span class="k">if</span> <span class="o">!</span><span class="n">ok</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"somevar does not implement BroadcastIface"</span><span class="p">)</span>
  <span class="p">}</span>

</code></pre></div></div>

<h3 id="json-marshall-type-conversion">Json Marshall type conversion</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">type</span> <span class="n">person</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Name</span>    <span class="kt">string</span>  <span class="s">`json:"name"`</span>
    <span class="n">Balance</span> <span class="kt">float64</span> <span class="s">`json:"balance,string"`</span>
  <span class="p">}</span>

  <span class="n">p</span> <span class="o">:=</span> <span class="n">person</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span> <span class="s">"Steve"</span><span class="p">,</span> <span class="n">Balance</span><span class="o">:</span> <span class="m">200</span><span class="p">}</span>
	<span class="n">jsonData</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">jsonData</span><span class="p">))</span>
  <span class="c">// {"name":"Steve","balance":"200"}</span>
  <span class="c">// Note balance of type float64 is automatically converted into string</span>
</code></pre></div></div>

<h3 id="a-case-for-empty-struct">A case for empty struct</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c">// an empty structure that occupies zero bytes of storage</span>
  <span class="c">// struct{}{}</span>

  <span class="c">// can be used instead of bool or int in done channel</span>
  <span class="n">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="k">struct</span><span class="p">{})</span>
  <span class="c">// ...</span>
  <span class="n">done</span> <span class="o">&lt;-</span> <span class="k">struct</span><span class="p">{}{}</span>


  <span class="k">type</span> <span class="n">CalcIface</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span>
    <span class="n">Sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span>
  <span class="p">}</span>

  <span class="c">// No receiver capture funcs, empty struct to group methods togetehr</span>
  <span class="k">type</span> <span class="n">calc</span> <span class="k">struct</span><span class="p">{}</span>

  <span class="k">func</span> <span class="p">(</span><span class="n">calc</span><span class="p">)</span> <span class="n">Add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="p">}</span>
  <span class="k">func</span> <span class="p">(</span><span class="n">calc</span><span class="p">)</span> <span class="n">Sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span> <span class="p">}</span>

  <span class="c">// only expose Calc and CalcIface</span>
  <span class="k">var</span> <span class="n">Calc</span> <span class="n">CalcIface</span> <span class="o">=</span> <span class="n">calc</span><span class="p">{}</span>
</code></pre></div></div>



    <a href="/2021/04/10/just-golang-things">Read More...</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2020/01/05/simpler-microfrontends-implementation-with-react-and-esnext">
        Simpler Microfrontends Implementation with React and ESNext
      </a>
    </h1>

    <span class="post-date">05 Jan 2020</span>

    <p>There has been a lot of talks and buzz around Microfrontends.</p>

<p>From <a href="https://micro-frontends.org/">https://micro-frontends.org/</a>, Microfrontend systems are</p>

<blockquote>
  <p>Techniques, strategies and recipes for building a modern web app with multiple teams that can ship features independently.</p>
</blockquote>

<p>The basic idea is to extend the idea of microservices to the frontend development through which a system can be divided into teams that own end to end system and independently deliver frontend applications to compose into a greater whole.</p>

<p>A simple illustration to explain the idea is shown as below:</p>

<h3 id="microservices-with-monolith-frontend">Microservices with Monolith Frontend</h3>
<p><img src="/images/microfrontends-1.png" alt="microservices" /></p>

<h3 id="microservices-with-micro-frontend">Microservices with Micro Frontend</h3>
<p><img src="/images/microfrontends-2.png" alt="microfrontends" /></p>

<p>Microfrontends brings the same benefits like performance, incremental upgrades, decoupled codebases, independent deployments, autonomous teams to the frontend engineering like microservices bring to backend services.</p>

<p>Now the teams and the UI can be broken down smaller groups as shown in the pictures but the challenge is in integration and serving a unified experience to the users and there will always be cases where interfaces or interface components will collide as UI components can easily expand cross pages/domains.</p>

<p>There are already a few architectures being that are being used and proposed to achieve Microfrontend architecture. Cam Jackson’s post on <a href="https://martinfowler.com/articles/micro-frontends.html#TheExample">Martin Fowler</a> includes some nice approaches.</p>

<p>Let’s see how our take on microfrontends at Cloudfactory affects page organization.</p>



    <a href="/2020/01/05/simpler-microfrontends-implementation-with-react-and-esnext">Read More...</a>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2020/01/05/making-test-driven-development-work">
        Making Test Driven Development work
      </a>
    </h1>

    <span class="post-date">05 Jan 2020</span>

    <p>Here are the slides for the presentation on Test Driven Development I gave at CloudFactory on a Lunch and Learn Session.</p>

<p>The goal of this talk was to introduce TDD as a process rather then a paradigm. It explains how TDD can provide lower defect rates, higher productivity, modular design and a much more logical and fun technique for us to solve problems. It describes the cycle of writing a test first, and application code afterwards – followed by refactoring. It tries to describe how to approach TDD: Where do I begin to develop? What exactly should I test? How should tests be structured?.</p>



    <a href="/2020/01/05/making-test-driven-development-work">Read More...</a>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
